# 데이터 마이그레이션 계획서 (Data Migration Plan)

**프로젝트:** Habitree Reading Hub v4.0.0  
**작성일:** 2026년 1월 12일  
**상태:** 초안 (사용자 검토 필요)

---

## 1. 개요 (Overview)

본 문서는 이전 시스템에서 사용하던 독서 데이터(사용자, 도서, 기록 등)를 현재의 **Habitree Reading Hub v4.0.0** 시스템으로 안전하게 마이그레이션하기 위한 기술적/절차적 계획을 정의합니다.

### 1.1 마이그레이션 목표
- 기존 사용자의 기록 및 독서 상태 유지
- 도서 정보의 무결성 확보 및 중복 제거
- 기록(메모, 인용구)과 이미지 데이터의 안정적인 이관

---

## 2. 데이터 요구사항 및 매핑 (Data Mapping)

분석된 노션 데이터베이스(**독서 리스트**)의 속성을 현재 시스템 테이블 구조에 맞게 매핑합니다.

### 2.1 도서 정보 (Books)
| 현재 시스템 필드 | 노션 속성명 (Property) | 비고 |
| :--- | :--- | :--- |
| `isbn` | **ISBN** | 13자리 숫자 추출 및 정제 필요 |
| `title` | **제목** | 텍스트만 추출 (하이퍼링크 제거) |
| `author` | **저자** | |
| `publisher` | **출판사** | |
| `cover_image_url` | **img_2** 또는 **img / 수식 2** | **img_2**는 노션 내부 파일이므로 다운로드 후 업로드 필요 |

### 2.2 사용자 독서 정보 (UserBooks)
| 현재 시스템 필드 | 노션 속성명 (Property) | 매핑 로직 |
| :--- | :--- | :--- |
| `status` | **독서상태** | **읽기전** → `not_started`<br>**읽는중**, **필사중** → `reading`<br>**완독** → `completed`<br>**재독** → `rereading` |
| `reading_reason` | **책읽는 이유** | |
| `started_at` | **등록일자 1** | 시작일로 준용 |
| `completed_at` | - | **완독** 상태인 경우 등록일 이후로 추정 입력 |

### 2.3 기록 및 부가 정보 (Notes & Meta)
- **책소개** 필드 데이터: 해당 책의 첫 번째 `memo` 타입 노트로 생성 가능
- **score** 필드: 향후 별점 기능 추가 시 "4.5⭐️⭐️⭐️⭐️☆" → `4.5`로 파싱하여 활용 가능
- **페이지 수**: 현재 시스템 스키마에 컬럼 추가 검토 가능

---

## 3. 마이그레이션 단계 (Migration Steps)

### 1단계: 데이터 정리 및 추출 (Organize & Extract)
1. **노션 데이터 내보내기**: 
    - Notion 우측 상단 `...` 메뉴 -> `내보내기(Export)` -> **CSV** 형식 선택
    - **Markdown & CSV** 선택 시 페이지 본문(Body) 내용도 함께 보관 가능
2. **데이터 정제 (Data Cleaning)**:
    - **ISBN**: 텍스트에 포함된 기호나 링크 제거
    - **이미지**: 노션 내부 이미지(`img_2`)는 익스포트 파일에 포함된 원본 파일을 당사 스토리지로 업로드

### 2단계: 데이터 변환 및 주입 (Transform & Load)
- **Supabase API**를 이용한 배치 삽입(Batch Insert) 스크립트 작성
- `books` -> `user_books` -> `notes` 순서로 외래 키 관계를 유지하며 주입

### 3단계: 테스트 마이그레이션 (Test Run)
- 개발 환경(Staging)에서 소규모 샘플 데이터를 사용하여 주입 테스트를 수행합니다.
- 데이터 손실이나 인덱스 오류가 없는지 검증합니다.

### 4단계: 전체 데이터 주입 (Execution)
- 운영 환경(Production)에서 정제된 전체 데이터를 일괄 주입합니다.
- `revalidatePath` 등을 통해 캐시를 갱신합니다.

### 5단계: 검증 (Verification)
- 사용자별로 데이터가 정확히 노출되는지 최종 확인합니다.

---

## 4. 사용자 협조 사항 (Action Items for User)

> [!IMPORTANT]
> 원활한 계획 수립을 위해 다음 정보가 필요합니다:
> 1. **이전 데이터의 형식**: (예: MySQL 덤프, Excel 파일, JSON 등)
> 2. **사용자 규모**: 약 몇 명의 사용자 데이터인지?
> 3. **이미지 데이터**: 사진 기록의 이미지가 별도의 스토리지(S3 등)에 있는지, 아니면 URL 형태인지?

---

### 5. 향후 일정
- [ ] 1차 계획서 승인
- [ ] 샘플 데이터 제공 및 구조 분석
- [ ] 마이그레이션 스크립트 작성
- [ ] 최종 마이그레이션 수행
