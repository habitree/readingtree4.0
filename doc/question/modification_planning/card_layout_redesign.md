# 카드 레이아웃 재설계 요구사항

**작성일:** 2026년 1월 11일  
**우선순위:** 최고  
**작업 범위:** ShareNoteCard 컴포넌트 완전 재구현

---

## 1. 문제 정의

### 1.1 현재 상황
- 외부 이미지(네이버 쇼핑 등) CORS 문제로 중간 표지 이미지 캡처 실패
- 필사/사진 이미지가 있는 기록도 오류 발생
- 이미지 유무에 관계없이 동일한 레이아웃 사용으로 인한 공간 낭비

### 1.2 근본 원인
- 필사/사진 이미지와 책 표지 이미지를 동일하게 처리
- 이미지가 없을 때 빈 공간을 효율적으로 활용하지 못함
- CORS 문제를 우회하려는 복잡한 시도가 오히려 기존 기능도 손상

---

## 2. 해결 방안: 두 가지 레이아웃 분리

### 2.1 레이아웃 A: 필사/사진 이미지가 **있을 때**

#### 구조
```
┌─────────────────────────────────────┐
│ [작은 표지]  책 제목/저자           │  <- 상단 헤더 (기존 동일)
│              211P RECORD            │
├─────────────────────────────────────┤
│                                     │
│     [필사/사진 이미지]              │  <- 메인 이미지 영역 (원본 크기 유지)
│                                     │
├─────────────────────────────────────┤
│ 기록  📅 2026.01.10                 │  <- 타입/날짜
│                                     │
│ 💬 "인상 깊은 구절..."              │  <- 인용구 (기존과 동일)
│                                     │
│ 🌿 My Reflection                    │  <- 감상 라벨
│ 내 생각...                          │  <- 감상 (기존과 동일)
│                                     │
├─────────────────────────────────────┤
│ [Habitree 로고]  by N  NTL          │  <- 푸터 (기존 동일)
└─────────────────────────────────────┘
```

#### 특징
- ✅ 기존 레이아웃 유지
- ✅ 필사/사진 이미지를 중간에 표시
- ✅ html2canvas로 정상 캡처 (Supabase Storage 이미지는 CORS 문제 없음)
- ✅ ImageLightbox 조건부 제거 (hideActions=true 시)

---

### 2.2 레이아웃 B: 필사/사진 이미지가 **없을 때**

#### 구조 (2단 레이아웃)
```
┌────────────────────────────────────────────────────────┐
│ [작은 표지]  책 제목/저자  211P RECORD                 │  <- 상단 헤더
├────────────────────────────────────────────────────────┤
│                        │                               │
│  💬 "인상 깊은 구절     │  기록  📅 2026.01.10          │
│   인상 깊은 구절..."    │                               │
│                        │  🌿 My Reflection             │
│  (왼쪽 영역 - 큰 폰트)  │                               │
│                        │  내 생각...                    │
│                        │  내 생각...                    │
│                        │                               │
│                        │  (우측 영역)                   │
├────────────────────────────────────────────────────────┤
│ [Habitree 로고]  by N  NTL                             │  <- 푸터
└────────────────────────────────────────────────────────┘
```

#### 특징
- ✅ **좌우 2단 레이아웃 유지** (기존 구조와 동일)
- ✅ **왼쪽 영역(기존 이미지 위치)**: 인상 깊은 구절 (크고 선명하게)
- ✅ **우측 영역(기존 인용구 위치)**: 내 생각 (전체 공간 활용)
- ✅ 왼쪽 위 작은 표지만 사용 (정상 캡처 확인됨)
- ✅ 좌우 균형 잡힌 레이아웃

---

## 3. 기술 요구사항

### 3.1 조건부 렌더링

```typescript
const hasImage = note.image_url && note.image_url.trim() !== "";

// 레이아웃 A
{hasImage && (
  <div className="메인 이미지 영역">
    <Image src={note.image_url} ... />
  </div>
)}

// 레이아웃 B용 스타일
<div className={cn(
  "텍스트 영역",
  hasImage ? "기본 크기" : "확장 크기"  // 이미지 없을 때 공간 확대
)}>
  인용구/감상
</div>
```

### 3.2 스타일 조정

#### 레이아웃 A (이미지 있음)
- 인용구 폰트: `text-base` (기존)
- 감상 폰트: `text-sm` (기존)
- 여백: 기본값

#### 레이아웃 B (이미지 없음)
- 인용구 폰트: `text-lg md:text-xl` (더 크게)
- 감상 폰트: `text-base md:text-lg` (더 크게)
- 여백: `py-8 md:py-12` (더 넓게)
- 최소 높이: `min-h-[400px]` (충분한 공간 확보)

### 3.3 이미지 처리

#### 필사/사진 이미지 (note.image_url)
- ✅ Supabase Storage에서 제공 (CORS 문제 없음)
- ✅ Next.js Image 컴포넌트 사용
- ✅ `hideActions=true` 시 ImageLightbox 제거
- ✅ `priority={true}`, `sizes` 명시

#### 왼쪽 위 작은 표지 (book.cover_image_url)
- ✅ 기존과 동일하게 유지
- ✅ 정상 캡처 확인됨

---

## 4. 구현 계획

### 4.1 단계별 작업

1. **조건 확인 로직**
   ```typescript
   const hasImage = note.image_url && note.image_url.trim() !== "";
   ```

2. **메인 영역 조건부 렌더링**
   - `hasImage=true`: 기존 이미지 영역 렌더링
   - `hasImage=false`: 이미지 영역 제거

3. **텍스트 영역 스타일 조정**
   - `hasImage` 값에 따라 클래스 동적 적용
   - 폰트 크기, 여백, 최소 높이 조정

4. **테스트**
   - 이미지 있는 기록: 기존처럼 이미지 캡처 확인
   - 이미지 없는 기록: 텍스트 확대 확인

### 4.2 파일 수정

- `components/share/share-note-card.tsx`
  - 조건부 렌더링 로직 추가
  - 스타일 조정

---

## 5. 예상 결과

### 5.1 레이아웃 A (이미지 있음)
- ✅ 필사/사진 이미지가 중간에 선명하게 표시됨
- ✅ 카드 복사 시 이미지 정상 캡처
- ✅ 기존 UX 유지

### 5.2 레이아웃 B (이미지 없음)
- ✅ 메인 이미지 영역 제거로 깔끔한 레이아웃
- ✅ 인용구와 감상이 더 크고 읽기 편함
- ✅ 공간 활용도 향상
- ✅ 왼쪽 표지만으로 책 식별 가능

---

## 6. 장점

### 6.1 문제 해결
- ✅ CORS 문제 회피 (외부 이미지 사용 안 함)
- ✅ 기존 필사/사진 이미지 기능 정상 작동
- ✅ 이미지 없는 기록의 공간 낭비 해소

### 6.2 UX 개선
- ✅ 이미지 유무에 따라 최적화된 레이아웃
- ✅ 텍스트 중심 기록의 가독성 향상
- ✅ 일관된 카드 복사 경험

### 6.3 기술 안정성
- ✅ 단순한 조건부 렌더링으로 복잡도 감소
- ✅ CORS 우회 시도 제거로 안정성 향상
- ✅ 기존 정상 작동 코드 최대한 보존

---

## 7. 체크리스트

### 개발 전
- [ ] MD 파일 검토 완료
- [ ] 요구사항 명확화 확인

### 개발 중
- [ ] `hasImage` 조건 로직 구현
- [ ] 레이아웃 A (이미지 있음) 조건부 렌더링
- [ ] 레이아웃 B (이미지 없음) 스타일 조정
- [ ] ImageLightbox 조건부 제거 (`hideActions`)
- [ ] 폰트 크기/여백 조정

### 개발 후
- [ ] 이미지 있는 기록 테스트
- [ ] 이미지 없는 기록 테스트
- [ ] 카드 복사 기능 테스트 (양쪽 모두)
- [ ] PC/모바일 반응형 확인

---

## 8. 참고 사항

### 8.1 기존 문제 회고
- 외부 이미지 CORS 문제를 해결하려고 복잡한 우회를 시도했으나 실패
- 이미지가 없는 경우에도 동일한 레이아웃을 강제하여 공간 낭비
- 필사/사진 이미지(Supabase Storage)는 CORS 문제가 없었음

### 8.2 새로운 접근
- **단순함이 최고**: 복잡한 우회보다 조건부 레이아웃 분리
- **실제 필요에 집중**: 필사/사진 이미지만 중간에 표시
- **공간 최적화**: 이미지 없을 때 텍스트 영역 확대

---

**이 문서를 기반으로 ShareNoteCard 컴포넌트를 재구현합니다.**
