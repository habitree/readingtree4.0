# 모바일 카드 복사 기능 개선 피드백

**작성일:** 2026년 1월 11일  
**검토 대상:** 모바일 카드 복사 기능 개선 제안서  
**검토자:** AI Assistant

---

## 1. 현재 상태 확인

### 1.1 카드 크기 및 레이아웃

**현재 구현:**
- 카드 최대 너비: `max-w-[960px]` (코드: `share-note-card.tsx:137`)
- 캡처용 고정 너비: `w-[960px]` (코드: `simple-share-dialog.tsx:425`)
- 현재 Scale: `3.0` (코드: `simple-share-dialog.tsx:164`)
- **현재 출력 크기: 960px × 3.0 = 2880px 너비**

**사용자 제안:**
- 표준 출력: `2048 × 1322` (비율 1.55:1)
- Scale 계산: `scale = 2048 / CSS width`

### 1.2 최소 폰트 크기 확인

**코드에서 확인된 최소 폰트 크기:**

| 위치 | 폰트 크기 | 용도 | 코드 위치 |
|------|----------|------|-----------|
| "Your Intelligence Forest" | `text-[10px]` | 로고 서브텍스트 | `share-note-card.tsx:128` |
| "211P Record" | `text-[10px]` | 페이지 번호 라벨 | `share-note-card.tsx:190` |
| "Record by" | `text-[10px]` | 사용자 라벨 | `share-note-card.tsx:372` |
| 타임스탬프 | `text-[10px]` | 이미지 하단 날짜 | `share-note-card.tsx:216, 236` |
| "Captured Moment" | `text-[10px]` | 이미지 하단 라벨 | `share-note-card.tsx:245` |

**결론: 현재 최소 폰트는 `text-[10px]` (10px)입니다.**

---

## 2. 제안 내용 검토

### 2.1 ✅ 올바른 제안

#### 1) 출력 규격 표준화 (2048×1322)
- **검토 결과: ✅ 합리적**
- 현재 2880px는 과도하며, 2048px로 표준화하는 것이 적절합니다.
- 높이 1322px로 통일하여 일관성 확보

#### 2) Scale 계산 방식 개선
- **검토 결과: ✅ 올바른 접근**
- `scale = 2048 / CSS width` 방식은 DPR에 독립적이며 안정적입니다.
- 현재: `scale = 3.0` (고정)
- 제안: `scale = 2048 / 960 ≈ 2.133`

#### 3) 이미지 로딩 보장 강화
- **검토 결과: ✅ 필수 개선**
- `img.decode()` 추가는 필수입니다.
- 현재는 `img.complete && img.naturalWidth > 0`만 확인하므로 부족합니다.

#### 4) 폰트 로딩 보장
- **검토 결과: ✅ 이미 구현됨**
- 현재 코드에 `await document.fonts.ready`가 이미 있습니다. (Line 113)

### 2.2 ⚠️ 수정/보완이 필요한 제안

#### 1) 가독성 기준 계산 재검토 필요

**사용자 제안:**
- 인스타 축소 후 최소 본문 ≥ 14px, 캡션 ≥ 12px
- 원본(2048) 기준 최소 폰트: 본문 27px+, 캡션 23px+

**현재 상태 분석:**
- 현재 최소 폰트: `text-[10px]` (10px)
- 제안된 scale (2.133) 적용 시: 10px × 2.133 = **21.33px**
- 인스타 축소 후 (×0.527): 21.33px × 0.527 = **11.25px**

**문제점:**
- ❌ 11.25px는 제안 기준(12px)보다 약간 작습니다.
- ❌ "본문 27px+" 기준에는 미달입니다.

**해결 방안:**
1. **최소 폰트 크기 상향 조정** (권장)
   - `text-[10px]` → `text-[12px]`로 변경
   - 계산: 12px × 2.133 = 25.6px (인스타 축소 후 13.5px) ✅
   
2. **Scale을 약간 높이기** (대안)
   - `scale = 2.4`로 조정
   - 계산: 10px × 2.4 = 24px (인스타 축소 후 12.65px) ✅
   - 단, 메모리 사용량 증가 (960px × 2.4 = 2304px)

**권장 사항:**
- ✅ **최소 폰트를 `text-[11px]`로 상향** (사용자 결정)
- 계산: 11px × 2.133 = 23.46px (인스타 축소 후 12.36px) ✅
- 이유: 메모리 사용량 증가 없이 가독성 확보, 기준 12px 충족

#### 2) 높이 1322px 통일 방법 명확화 필요

**사용자 제안:**
- "짧은 레이아웃은 하단 패딩으로 1322에 맞춰 통일"

**현재 상태:**
- 카드 높이는 콘텐츠에 따라 가변적입니다.
- `min-h-[560px]`만 설정되어 있습니다. (코드: `share-note-card.tsx:139`)

**구현 방법 제안:**
1. **CSS로 고정 높이 설정** (권장)
   ```typescript
   // 캡처용 카드에 고정 높이 적용
   <div 
     ref={captureRef} 
     className="... h-[1322px]" // 또는 style={{ height: '1322px' }}
   >
   ```

2. **html2canvas 옵션으로 크기 조정**
   - `height: 1322` 옵션 사용 (가능한지 확인 필요)

**질문:**
- Q1: 높이를 고정하면 콘텐츠가 넘칠 수 있습니다. 어떻게 처리할까요?
  - A) 스크롤 불가능한 영역으로 잘림
  - B) 콘텐츠를 축소하여 맞춤
  - C) 높이를 유연하게 조정 (최소 1322px, 콘텐츠에 따라 증가)

**✅ 사용자 결정: 높이 유연 조정 (비율은 유지)**
- 최소 높이 1322px를 기준으로 하되, 콘텐츠가 넘칠 경우 비율을 유지하며 높이 증가
- 비율 1.55:1 (2048:1322) 유지

### 2.3 ❌ 잘못된 가정 또는 오류

#### 1) 샘플 규격과 현재 구현 불일치

**사용자 언급:**
- "샘플 #1, #3: 2048 × 1322"
- "샘플 #2: 2048 × 1194"

**현재 구현:**
- 카드 너비: 960px (고정)
- Scale: 3.0
- **실제 출력: 2880px 너비** (2048px가 아님)

**문제:**
- 현재 출력이 2048px가 아닌 2880px입니다.
- 샘플 규격과 현재 구현이 일치하지 않습니다.

**해결:**
- Scale을 2.133으로 조정하여 2048px 출력으로 맞춰야 합니다.

#### 2) windowWidth 설정 재검토 필요

**현재 설정:**
- `windowWidth: 1200` (코드: `simple-share-dialog.tsx:170`)

**사용자 제안:**
- CSS width 기준으로 scale 계산

**문제:**
- `windowWidth: 1200`은 실제 카드 너비(960px)와 다릅니다.
- 이로 인해 렌더링 오차가 발생할 수 있습니다.

**권장:**
- `windowWidth: 960`으로 변경 (실제 카드 너비와 일치)

---

## 3. 추가 질문 및 확인 사항

### 3.1 필수 확인 사항

#### Q1: 높이 1322px 통일 방법
- **질문:** 콘텐츠가 1322px를 초과할 경우 어떻게 처리할까요?
  - A) 잘림 허용
  - B) 콘텐츠 축소
  - C) 높이 유연 조정 (최소 1322px)

**✅ 사용자 결정: 높이 유연 조정 (비율은 유지)**
- 최소 높이 1322px를 기준으로 하되, 콘텐츠가 넘칠 경우 비율을 유지하며 높이 증가
- 비율 1.55:1 (2048:1322) 유지

#### Q2: 이미지 없는 레이아웃 처리
- **질문:** 이미지 없는 레이아웃도 1322px로 통일할까요?
- 현재 코드에서 이미지 없을 때와 있을 때 레이아웃이 다릅니다.

**✅ 사용자 결정: 이미지 없는 레이아웃은 따로 조정**
- 이미지 있는 레이아웃: 1322px 기준 (비율 유지하며 유연 조정)
- 이미지 없는 레이아웃: 별도 높이 계산 (콘텐츠에 맞춰 조정)

#### Q3: 모바일/PC Scale 분리
- **질문:** 모바일과 PC에서 다른 Scale을 사용할까요?
- 사용자 제안에는 모바일 최적화가 언급되지 않았습니다.
- 기존 문서(`mobile_card_copy_improvement.md`)에는 모바일 1.5, PC 3.0 제안이 있습니다.

**✅ 사용자 결정: 모바일은 다른 스케일로 적용**

**최종 결정:**
- **PC**: `scale = 2.133` (2048px 출력, 비율 1.55:1 유지)
- **모바일**: `scale = 1.5` (메모리 절약, 출력 1440px)
  - 모바일 출력: 960px × 1.5 = 1440px 너비
  - 높이: 1440px / 1.55 ≈ 929px (비율 유지)

### 3.2 구현 우선순위

#### Phase 1: 즉시 적용 가능 (필수)
1. ✅ Scale 계산 방식 변경: `scale = 2048 / 960 ≈ 2.133`
2. ✅ `windowWidth: 960`으로 변경
3. ✅ `imageTimeout: 15000` 설정 (무한 대기 방지)
4. ✅ 이미지 로딩 보장: `img.decode()` 추가

#### Phase 2: 가독성 개선 (권장)

1. ✅ 최소 폰트 크기 상향: `text-[10px]` → `text-[11px]` (사용자 결정)
2. ✅ 높이 1322px 통일 방법 결정: 유연 조정 (비율 유지)
3. ⚠️ 이미지 없는 레이아웃 별도 처리 구현

#### Phase 3: 모바일 최적화 (필수)
1. ✅ 모바일/PC Scale 분리 (사용자 결정)
   - PC: `scale = 2.133` (2048px 출력)
   - 모바일: `scale = 1.5` (1440px 출력)
2. ⚠️ 메모리 사용량 모니터링

---

## 4. 수정된 구현 제안

### 4.1 Scale 계산 로직 (모바일/PC 분리)

```typescript
// 현재
const canvas = await html2canvas(targetElement, {
  scale: 3.0,
  windowWidth: 1200,
  // ...
});

// 수정 제안 (모바일/PC 분리)
import { isMobile } from "@/lib/utils/device";

const TARGET_WIDTH_PC = 2048;
const TARGET_WIDTH_MOBILE = 1440; // 모바일 최적화
const CARD_WIDTH = 960; // 실제 카드 너비

const isMobileDevice = isMobile();
const targetWidth = isMobileDevice ? TARGET_WIDTH_MOBILE : TARGET_WIDTH_PC;
const scale = targetWidth / CARD_WIDTH; // PC: 2.133, 모바일: 1.5

const canvas = await html2canvas(targetElement, {
  scale: scale,
  windowWidth: CARD_WIDTH, // 960으로 변경
  imageTimeout: 15000, // 무한 대기 방지
  // ...
});

console.log(`[카드 복사] ${isMobileDevice ? '모바일' : 'PC'} 모드 - Scale: ${scale}, 출력 너비: ${targetWidth}px`);
```

### 4.2 이미지 로딩 보장 강화

```typescript
// 현재
if (img.complete && img.naturalWidth > 0 && img.naturalHeight > 0) {
  resolve();
  return;
}

// 수정 제안
if (img.complete && img.naturalWidth > 0 && img.naturalHeight > 0) {
  // 디코딩 완료 보장
  try {
    await img.decode();
  } catch (e) {
    console.warn("이미지 디코딩 실패:", e);
  }
  resolve();
  return;
}
```

### 4.3 최소 폰트 크기 상향 (11px 적용)

```typescript
// 현재
<span className="text-[10px] ...">

// 수정 제안 (가독성 개선 - 11px 적용)
<span className="text-[11px] ...">
```

**적용 위치:**
- `share-note-card.tsx:128` - "Your Intelligence Forest"
- `share-note-card.tsx:190` - "211P Record"
- `share-note-card.tsx:372` - "Record by"
- `share-note-card.tsx:216, 236` - 타임스탬프
- `share-note-card.tsx:245` - "Captured Moment"

### 4.4 높이 유연 조정 (비율 유지)

```typescript
// 높이 유연 조정 구현
// 비율 1.55:1 (2048:1322) 유지

const CARD_WIDTH = 960;
const TARGET_WIDTH_PC = 2048;
const TARGET_WIDTH_MOBILE = 1440;
const ASPECT_RATIO = 2048 / 1322; // ≈ 1.55

const isMobileDevice = isMobile();
const targetWidth = isMobileDevice ? TARGET_WIDTH_MOBILE : TARGET_WIDTH_PC;
const minHeight = targetWidth / ASPECT_RATIO; // PC: 1322px, 모바일: 929px

// 캡처용 컨테이너
<div 
  ref={captureRef} 
  className="..."
  style={{ 
    width: `${CARD_WIDTH}px`,
    minHeight: `${minHeight}px`, // 최소 높이 설정
    // 콘텐츠가 넘칠 경우 자동으로 높이 증가 (비율 유지)
  }}
>
  <ShareNoteCard ... />
</div>

// 이미지 없는 레이아웃은 별도 처리
// hasImage에 따라 다른 높이 계산
```

---

## 5. 가독성 기준 계산 상세

### 5.1 현재 상태 (Scale 3.0)

| 폰트 크기 | 원본 (960px) | 출력 (2880px) | 인스타 축소 후 (1518px) |
|----------|-------------|--------------|---------------------|
| text-[10px] | 10px | 30px | 15.8px ✅ |
| text-[12px] | 12px | 36px | 19.0px ✅ |
| text-[14px] | 14px | 42px | 22.1px ✅ |

**결론:** Scale 3.0에서는 가독성 문제 없음 (하지만 메모리 사용량 과다)

### 5.2 제안 상태 (Scale 2.133)

| 폰트 크기 | 원본 (960px) | 출력 (2048px) | 인스타 축소 후 (1080px) |
|----------|-------------|--------------|---------------------|
| text-[10px] | 10px | 21.33px | 11.25px ⚠️ (12px 미달) |
| text-[12px] | 12px | 25.6px | 13.5px ✅ |
| text-[14px] | 14px | 29.87px | 15.75px ✅ |

**결론:** 
- `text-[10px]`는 기준(12px)에 약간 부족
- ✅ **`text-[11px]`로 상향 결정** (인스타 축소 후 12.36px, 기준 충족)

### 5.3 최소 폰트 크기별 인스타 가독성

**기준: 인스타 업로드 후 최소 12px 유지**

| 원본 폰트 | Scale 2.133 | 인스타 축소 후 | 가독성 |
|----------|------------|--------------|--------|
| 10px | 21.33px | 11.25px | ⚠️ 부족 |
| 11px | 23.46px | 12.36px | ✅ 충족 |
| 12px | 25.6px | 13.5px | ✅ 충족 |

**✅ 결정:** `text-[11px]`로 상향 (사용자 결정)
- 인스타 축소 후 12.36px로 기준 12px 충족

---

## 6. 체크리스트

### 개발 전 확인
- [x] 높이 1322px 통일 방법 결정: ✅ 유연 조정 (비율 유지)
- [x] 이미지 없는 레이아웃 처리 방법 결정: ✅ 별도 조정
- [x] 모바일/PC Scale 분리 여부 결정: ✅ 분리 적용
- [x] 최소 폰트 크기 상향 여부 결정: ✅ 11px 적용

### 개발 중
- [ ] Scale 계산 로직 변경 (PC: 2.133, 모바일: 1.5)
- [ ] 모바일/PC 분기 처리 추가
- [ ] `windowWidth: 960`으로 변경
- [ ] `imageTimeout: 15000` 설정
- [ ] `img.decode()` 추가
- [ ] 높이 유연 조정 구현 (비율 1.55:1 유지)
- [ ] 이미지 없는 레이아웃 별도 처리
- [ ] 최소 폰트 크기 상향 (11px 적용)

### 개발 후
- [ ] 출력 크기 확인 (2048px 너비)
- [ ] 출력 높이 확인 (1322px 또는 유연)
- [ ] 인스타 업로드 후 가독성 테스트
- [ ] 모바일/PC 모두 테스트
- [ ] 메모리 사용량 확인
- [ ] 이미지 로딩 성공률 확인

---

## 7. 요약

### ✅ 올바른 제안
1. 출력 규격 2048×1322 표준화
2. Scale 계산 방식 개선 (`scale = 2048 / CSS width`)
3. 이미지 로딩 보장 강화 (`img.decode()` 추가)
4. 폰트 로딩 보장 (이미 구현됨)

### ✅ 결정 사항
1. **최소 폰트 크기**: `text-[10px]` → `text-[11px]` 적용 ✅
2. **높이 통일 방법**: 유연 조정 (비율 1.55:1 유지) ✅
3. **모바일/PC Scale 분리**: PC 2.133, 모바일 1.5 ✅
4. **이미지 없는 레이아웃**: 별도 조정 ✅

### ⚠️ 수정 필요
1. **windowWidth**: 1200 → 960으로 변경 필요
2. **imageTimeout**: 0 → 15000으로 변경 필요

### 📊 핵심 수치 정리

| 항목 | 현재 | 제안 (PC) | 제안 (모바일) | 비고 |
|------|------|----------|-------------|------|
| 출력 너비 | 2880px | 2048px | 1440px | PC: Scale 2.133, 모바일: 1.5 |
| 출력 높이 | 가변 | 최소 1322px (유연) | 최소 929px (유연) | 비율 1.55:1 유지 |
| Scale | 3.0 (고정) | 2.133 (계산) | 1.5 (계산) | PC: `2048/960`, 모바일: `1440/960` |
| windowWidth | 1200 | 960 | 960 | 카드 너비와 일치 |
| 최소 폰트 | 10px | 11px | 11px | 가독성 개선 |
| imageTimeout | 0 (무한) | 15000 | 15000 | 타임아웃 설정 |
| 인스타 축소 후 최소 폰트 | 15.8px | 12.36px | 8.7px | PC 기준 12px 충족 |
| 이미지 없는 레이아웃 | 동일 | 별도 조정 | 별도 조정 | 콘텐츠에 맞춰 조정 |

---

## 8. 다음 단계

1. **즉시 적용 (Phase 1)**
   - Scale 계산 로직 변경 (모바일/PC 분리)
   - windowWidth 수정
   - imageTimeout 설정
   - img.decode() 추가

2. **가독성 개선 (Phase 2)**
   - 최소 폰트 크기 상향 적용 (11px)
   - 높이 유연 조정 구현 (비율 1.55:1 유지)
   - 이미지 없는 레이아웃 별도 처리

3. **모바일 최적화 (Phase 3)**
   - 모바일/PC Scale 분리 구현 완료
   - 메모리 사용량 모니터링
   - 모바일/PC 각각 테스트

---

**이 피드백을 바탕으로 구현 계획을 수정하시기 바랍니다.**
