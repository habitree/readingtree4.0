# 규칙 파일 검토 및 개선 사항

**작성일:** 2025년 1월  
**프로젝트:** Habitree Reading Hub v4.0.0

---

## 검토 개요

모든 `.cursor/rules/*.mdc` 파일을 검토하여 고도화 시 제약사항이나 문제점을 파악하고 개선했습니다.

---

## 발견된 문제점 및 개선 사항

### 1. datarule.mdc

#### 문제점
- ❌ 존재하지 않는 경로 언급: `src/repositories/**`, `src/services/**`
- ❌ 마이그레이션 파일명 규칙 불일치 (`migration-` 접두사 누락)
- ❌ 과도하게 상세한 예시 코드 (11.2 섹션)

#### 개선 사항
- ✅ 존재하지 않는 경로 제거
- ✅ 마이그레이션 파일명 규칙 통일 (`migration-YYYYMMDDHHmm__...` 형식)
- ✅ 예시 코드 간소화 (핵심 패턴만 유지)

---

### 2. db_rls_rule.mdc

#### 문제점
- ❌ "profiles는 auth.users.id와 1:1로 매핑" → 실제로는 `users` 테이블
- ❌ 불필요하게 상세한 SQL 예시

#### 개선 사항
- ✅ "users는 auth.users.id와 1:1로 매핑"으로 수정
- ✅ SQL 예시 간소화

---

### 3. auth_session_rule.mdc

#### 문제점
- ❌ `contexts/auth-context.tsx`에서 `getUser()` 직접 호출 금지 언급 (실제로는 사용하지 않음)
- ❌ "변경 전/변경 후" 예시가 불필요하게 상세함

#### 개선 사항
- ✅ 금지 경로에서 `contexts/auth-context.tsx` 제거 (실제로 사용하지 않음)
- ✅ 예시 코드 간소화 (핵심 패턴만 유지)

---

### 4. migration_rule.mdc

#### 문제점
- ❌ 과도하게 상세한 주석 템플릿
- ❌ 불필요하게 긴 예시 코드

#### 개선 사항
- ✅ 주석 템플릿 간소화 (필수 정보만)
- ✅ 예시 코드 간소화

---

### 5. ui_datarule.mdc

#### 상태
- ✅ 중복 없음, 적절한 수준의 상세도 유지

---

## 고도화 시 고려사항

### 1. 레이어 분리 규칙의 확장성

**현재 규칙:**
- UI 레이어: `components/**`, `hooks/**`, `contexts/**`, `app/**`
- 데이터 레이어: `app/actions/**`

**고도화 시 고려사항:**
- 향후 도메인 레이어(`domain/**`) 추가 시 규칙 업데이트 필요
- 비즈니스 로직 레이어 분리 시 규칙 확장 필요

**권장 사항:**
- 현재 규칙은 유지하되, 새로운 레이어 추가 시 규칙 문서 업데이트

---

### 2. 인증/세션 관리 규칙의 확장성

**현재 규칙:**
- 서버 중심 (SSR/쿠키 기반)으로 고정

**고도화 시 고려사항:**
- 실시간 기능(WebSocket, Server-Sent Events) 추가 시 세션 관리 방식 검토 필요
- 다중 디바이스 세션 관리 시 규칙 확장 필요

**권장 사항:**
- 현재 규칙 유지, 실시간 기능 추가 시 별도 규칙 문서 작성

---

### 3. DB/RLS 규칙의 확장성

**현재 규칙:**
- `auth.uid() = user_id` 패턴 표준화
- 모든 테이블에 즉시 RLS 적용

**고도화 시 고려사항:**
- 복잡한 권한 모델(역할 기반 접근 제어, 다중 소유자 등) 추가 시 규칙 확장 필요
- 성능 최적화를 위한 RLS 정책 최적화 시 규칙 업데이트 필요

**권장 사항:**
- 현재 규칙 유지, 복잡한 권한 모델 추가 시 규칙 확장

---

### 4. 마이그레이션 규칙의 확장성

**현재 규칙:**
- 파일명: `migration-YYYYMMDDHHmm__<기능명>__<변경내용>.sql`
- Idempotent 작성 필수

**고도화 시 고려사항:**
- 마이그레이션 롤백 전략 추가 시 규칙 확장 필요
- 데이터 마이그레이션(데이터 변환) 시 별도 규칙 필요

**권장 사항:**
- 현재 규칙 유지, 롤백 전략 추가 시 규칙 확장

---

## 규칙 간 일관성

### ✅ 일관성 확보 완료

1. **마이그레이션 파일명 규칙 통일**
   - `datarule.mdc`: `migration-YYYYMMDDHHmm__...` 형식으로 통일
   - `migration_rule.mdc`: 동일한 형식 유지

2. **용어 통일**
   - `profiles` → `users`로 통일
   - `auth.users(id)` 참조 일관성 유지

3. **예시 코드 간소화**
   - 모든 규칙 파일에서 불필요하게 상세한 예시 제거
   - 핵심 패턴만 유지하여 가독성 향상

---

## 제약사항 및 제한사항

### 1. 현재 규칙의 제약사항

**레이어 분리 규칙:**
- ❌ 도메인 레이어 분리 미지원 (현재는 UI/Data만 분리)
- ❌ 비즈니스 로직 레이어 분리 미지원

**인증/세션 규칙:**
- ❌ 클라이언트 중심 세션 관리 미지원 (서버 중심만 지원)
- ❌ 다중 세션 관리 미지원

**DB/RLS 규칙:**
- ❌ 복잡한 권한 모델 미지원 (단순 소유자 기반만 지원)
- ❌ 역할 기반 접근 제어(RBAC) 미지원

**마이그레이션 규칙:**
- ❌ 롤백 전략 미지원
- ❌ 데이터 마이그레이션 전략 미지원

### 2. 고도화 시 필요한 추가 규칙

1. **도메인 레이어 분리 규칙** (향후 필요 시)
2. **비즈니스 로직 레이어 분리 규칙** (향후 필요 시)
3. **복잡한 권한 모델 규칙** (향후 필요 시)
4. **마이그레이션 롤백 전략 규칙** (향후 필요 시)

---

## 권장 사항

### 1. 규칙 유지보수

- ✅ 규칙 파일은 프로젝트 구조 변경 시 함께 업데이트
- ✅ 새로운 레이어 추가 시 규칙 확장 검토
- ✅ 규칙 위반 사례 발견 시 규칙 문서 업데이트

### 2. 규칙 적용

- ✅ 새로운 코드는 규칙을 엄격히 준수
- ✅ 기존 코드는 점진적으로 규칙에 맞게 리팩토링
- ✅ 규칙 위반 코드 발견 시 즉시 수정 또는 문서화

### 3. 규칙 문서화

- ✅ 규칙 변경 시 버전 업데이트
- ✅ 변경 이력 기록
- ✅ 규칙 간 상호 참조 유지

---

## 결론

모든 규칙 파일을 검토하고 다음 사항을 개선했습니다:

1. ✅ 존재하지 않는 경로 제거
2. ✅ 용어 통일 (`profiles` → `users`)
3. ✅ 마이그레이션 파일명 규칙 통일
4. ✅ 불필요하게 상세한 예시 코드 간소화
5. ✅ 규칙 간 일관성 확보

**현재 규칙들은 프로젝트 고도화에 적합하며, 향후 필요 시 확장 가능한 구조로 정리되었습니다.**

---

**마지막 업데이트:** 2025년 1월

